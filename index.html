<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>АРХЕТИП — тест</title>

  <style>
    :root{
      --bg:#0b1118;
      --ink:#e9ecef;
      --muted:rgba(233,236,239,.72);
      --dim:rgba(233,236,239,.48);
      --line:rgba(233,236,239,.18);
      --line2:rgba(233,236,239,.26);
      --glow: rgba(233,236,239,.18);
      --max:1120px;
      --pad:28px;
      --pad2:22px;
      --radius:0px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --serif: ui-serif, Georgia, "Times New Roman", Times, serif;
      --author:#9fd3ff;
      --authorGlow: rgba(159, 211, 255, .22);
    }

    html, body { height: 100%; }
    body{
      margin:0;
      color:var(--ink);
      font-family: var(--font);
      background: var(--bg);
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ======= Background: grain + faint geometry ======= */
    .stage{
      min-height: 100%;
      position: relative;
      isolation: isolate;
      background:
        radial-gradient(1200px 700px at 20% 20%, rgba(233,236,239,.06), transparent 55%),
        radial-gradient(900px 540px at 80% 30%, rgba(233,236,239,.04), transparent 60%),
        radial-gradient(1000px 800px at 60% 85%, rgba(233,236,239,.03), transparent 65%),
        linear-gradient(180deg, rgba(255,255,255,.03), transparent 40%, rgba(0,0,0,.22));
    }
    .stage::before{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background-image:
        repeating-linear-gradient(0deg, rgba(233,236,239,.045) 0 1px, transparent 1px 28px),
        repeating-linear-gradient(90deg, rgba(233,236,239,.03) 0 1px, transparent 1px 34px);
      opacity:.18;
      mix-blend-mode: screen;
      z-index:0;
    }
    .stage::after{
      content:"";
      position:absolute; inset:-20%;
      pointer-events:none;
      background:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='800'%3E%3Cdefs%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3C/defs%3E%3Crect width='800' height='800' filter='url(%23n)' opacity='.33'/%3E%3C/svg%3E");
      opacity:.12;
      mix-blend-mode: overlay;
      z-index:0;
      transform: rotate(-2deg);
    }

    .wrap{
      position: relative;
      z-index:1;
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 var(--pad);
    }

    /* ======= Top bar ======= */
    .topbar{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 18px;
      padding: 20px 0 14px;
      border-bottom: 1px solid var(--line);
    }
    .top-left, .top-right{
      display:flex;
      gap: 18px;
      align-items:center;
      min-width: 180px;
    }
    .top-left a, .top-right a{
      color: var(--muted);
      text-decoration:none;
      font-size: 12px;
      letter-spacing: .16em;
      text-transform: uppercase;
      font-family: var(--mono);
    }
    .top-left a:hover, .top-right a:hover{
      color: var(--ink);
    }
    .top-center{
      text-align:center;
      flex:1;
      font-family: var(--mono);
      letter-spacing: .28em;
      text-transform: uppercase;
      font-size: 16px;
      color: var(--ink);
      opacity:.92;
    }

    /* ======= Main area ======= */
    .main{
      padding: 26px 0 40px;
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap: 36px;
      align-items: start;
    }
    @media (max-width: 980px){
      .wrap{ padding: 0 16px; }
      .top-left, .top-right{ min-width: auto; }
      .main{ grid-template-columns: 1fr; gap: 20px; }
    }

    .kicker{
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: var(--muted);
      margin: 10px 0 10px;
    }

    .bigTitle{
      font-family: var(--serif);
      font-weight: 400;
      letter-spacing: .04em;
      text-transform: uppercase;
      font-size: clamp(32px, 5vw, 54px);
      line-height: 1.08;
      margin: 6px 0 18px;
    }
    .questionTitle{
      font-size: clamp(24px, 3.6vw, 36px);
      letter-spacing: .02em;
      line-height: 1.16;
      font-weight: 400;
      text-transform: none;
    }

    .bodyText{
      color: var(--muted);
      line-height: 1.7;
      font-size: 15px;
      max-width: 58ch;
      margin: 0 0 22px;
    }

    .divider{
      height:1px;
      background: var(--line);
      margin: 16px 0 18px;
      width: min(520px, 100%);
    }

    /* ======= Answers ======= */
    .answers{
      display:flex;
      flex-direction: column;
      gap: 10px;
      width: min(560px, 100%);
    }
    .choice{
      display:flex;
      align-items:flex-start;
      gap: 12px;
      padding: 14px 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.02);
      color: var(--ink);
      cursor:pointer;
      user-select:none;
      transition: border-color .12s ease, background .12s ease;
    }
    .choice:hover{
      border-color: var(--line2);
      background: rgba(255,255,255,.035);
    }
    .choice:active{
      transform: translateY(1px);
    }
    .bullet{
      width: 10px; height: 10px;
      border: 1px solid var(--line2);
      margin-top: 4px;
      flex: 0 0 auto;
      opacity:.9;
    }
    .choiceText{
      line-height: 1.55;
      font-size: 15px;
      color: var(--ink);
    }

    /* ======= Right panel (quiet) ======= */
    .side{
      padding-top: 10px;
      color: var(--muted);
    }
    .sideBlock{
      border-left: 1px solid var(--line);
      padding-left: 18px;
      margin-bottom: 18px;
    }
    .sideLabel{
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: var(--muted);
      margin: 0 0 8px;
    }
    .sideText{
      font-size: 13px;
      line-height: 1.7;
      margin: 0;
      color: var(--muted);
    }
    .miniRow{
      display:flex; gap: 10px; flex-wrap: wrap;
      margin-top: 12px;
      color: var(--dim);
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: .06em;
    }
    .pill{
      border: 1px solid var(--line);
      padding: 6px 10px;
      background: rgba(255,255,255,.02);
    }

    /* ======= Bottom controls ======= */
    .controls{
      margin-top: 18px;
      display:flex;
      gap: 14px;
      align-items:center;
      flex-wrap: wrap;
    }
    .btn{
      border: 1px solid var(--line2);
      background: rgba(255,255,255,.01);
      color: var(--ink);
      padding: 12px 18px;
      font-family: var(--mono);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: 12px;
      cursor:pointer;
      transition: background .12s ease, border-color .12s ease;
      display:inline-flex;
      align-items:center;
      gap: 8px;
    }
    .btn:hover{
      border-color: rgba(233,236,239,.35);
      background: rgba(255,255,255,.03);
    }
    .btn:disabled{
      opacity: .4;
      cursor:not-allowed;
    }
    .btnAuthor{
  border: 1px solid rgba(159, 211, 255, .38);
  background: rgba(159, 211, 255, .06);
  color: var(--ink);
  padding: 10px 16px;
  font-family: var(--mono);
  letter-spacing: .14em;
  text-transform: uppercase;
  font-size: 12px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 0;
  box-shadow: 0 0 12px var(--authorGlow);
  transition: background .12s ease, border-color .12s ease, box-shadow .12s ease;
  min-width: 220px;
}

.btnAuthor:hover{
  border-color: rgba(159, 211, 255, .55);
  background: rgba(159, 211, 255, .10);
  box-shadow: 0 0 16px rgba(159, 211, 255, .28);
}
    .linkBtn{
      border: none;
      background: transparent;
      color: var(--muted);
      font-family: var(--mono);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: 12px;
      cursor:pointer;
      padding: 12px 8px;
    }
    .linkBtn:hover{ color: var(--ink); }

    /* Progress line (thin) */
    .progressLine{
      width: min(560px, 100%);
      height: 1px;
      background: var(--line);
      position: relative;
      margin: 14px 0 18px;
    }
    .progressLine > i{
      display:block;
      height: 1px;
      width: 0%;
      background: rgba(233,236,239,.72);
      box-shadow: 0 0 8px var(--glow);
    }

    /* Small helper */
    .muted{ color: var(--muted); }
    .hidden{ display:none !important; }

    /* ======= Results ======= */
    .resultTitle{
      margin-bottom: 6px;
      text-transform: none;
      letter-spacing: .02em;
    }
    .resultSub{
      font-family: var(--mono);
      text-transform: none;
      letter-spacing: .06em;
      font-size: 12px;
      color: var(--muted);
    }
    .resultText{
      font-size: 15px;
      line-height: 1.75;
      margin: 0 0 10px;
    }
    .resultSteps{
      display:flex;
      flex-direction: column;
      gap: 8px;
      margin: 6px 0 2px;
    }
    .resultStep{
      border: 1px solid var(--line);
      padding: 10px 12px;
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--muted);
      background: rgba(255,255,255,.02);
    }
    .resultStep.is-active{
      color: var(--ink);
      border-color: var(--line2);
      background: rgba(255,255,255,.04);
      box-shadow: 0 0 10px var(--glow);
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="wrap">
      <div class="topbar">
        <div class="top-left">
          <a href="#" id="aboutLink">ОБ АРХЕТИПАХ</a>
          <a href="#" id="settingsLink">НАСТРОЙКА</a>
        </div>
        <div class="top-center">АРХЕТИП</div>
        <div class="top-right">
          <a href="#" id="exitLink">ВЫХОД</a>
        </div>
      </div>

      <div id="app"></div>
    </div>
  </div>

<script>
/* ===================== Data ===================== */
const ARCHETYPES = {
  gatekeeper: {
    id: "gatekeeper",
    role: "Хранитель Порога",
    character: "Баба-Яга",
    short: "границы · допуск · защита целостности"
  },
  spark: {
    id: "spark",
    role: "Носитель Искры",
    character: "Жар-птица",
    short: "инициация · оживление · начало движения"
  },
  namer: {
    id: "namer",
    role: "Дающий Имя",
    character: "Василиса Премудрая",
    short: "смысл · называние · оформление переживания"
  },
  support: {
    id: "support",
    role: "Несущий Опору",
    character: "Сивка-Бурка",
    short: "удержание · ответственность · продолжение"
  },
  connector: {
    id: "connector",
    role: "Связующий",
    character: "Серый Волк",
    short: "контакт · поле между · удержание связи"
  },
  breaker: {
    id: "breaker",
    role: "Разрушитель Форм",
    character: "",
    short: "разрыв · демонтаж ложного · освобождение"
  },
  integrator: {
    id: "integrator",
    role: "Собиратель Осколков",
    character: "",
    short: "проживание · интеграция · сборка после распада"
  },
  wanderer: {
    id: "wanderer",
    role: "Странствующий Путник",
    character: "",
    short: "путь · движение · баланс через переход"
  }
};

const RESULT_TEXTS = {
  gatekeeper: {
    dominant:
      "Ведущей стратегией становится внимание к границам: где безопасно, где рано, где лучше остановиться. Решения проходят через внутреннюю проверку готовности и условий. Эта позиция помогает сохранять целостность и не входить в риск преждевременно.",
    shadow:
      "При перегрузке защита усиливается: осторожность превращается в закрытость, границы — в стены. Это способ сохранить безопасность, но он может надолго задерживать движение и контакт.",
    deficit:
      "Может не хватать доверия процессу и простого шага. Ожидание полной готовности затягивается, и развитие откладывается дольше, чем нужно."
  },
  spark: {
    dominant:
      "Основной способ включаться в жизнь — через импульс и интерес. Легко чувствуется момент начала, новизна, «искрение» смысла. Это источник энергии и обновления — часто запускает движение.",
    shadow:
      "Под давлением импульс рассеивается: появляется ожидание «сильного толчка» или метание от одного начала к другому. Энергия уходит в беспокойство вместо продолжения.",
    deficit:
      "Может не хватать устойчивости: начатому сложно дать время и опору. Развитие требует не только искры, но и присутствия в процессе."
  },
  namer: {
    dominant:
      "Преобладает стремление понимать и осмыслять происходящее. Через формулирование появляется опора: переживания становятся яснее, хаос — структурнее. Это снижает тревогу и повышает точность выбора.",
    shadow:
      "В напряжении осмысление может подменять действие: шаг откладывается, потому что «ещё не до конца понятно». Понимание превращается в способ избегания риска.",
    deficit:
      "Может не хватать опыта без объяснений: не всё требует имени заранее. Иногда смысл появляется после действия, а не до него."
  },
  support: {
    dominant:
      "Ведущая стратегия — выдержка и ответственность. Есть способность продолжать в длительных процессах, держать обещания и ритм. Это надёжность: на такую позицию часто опираются другие.",
    shadow:
      "При перегрузке возникает привычка тащить всё в одиночку. Отдых и помощь откладываются, напряжение накапливается — сила начинает работать на износ.",
    deficit:
      "Может не хватать обновления: удерживается то, что уже перестало быть живым. Иногда опора — это не продолжать любой ценой, а вовремя пересобрать маршрут."
  },
  connector: {
    dominant:
      "Основная способность — удерживать контакт и «поле между». Легко становятся заметны нюансы отношений, переходы, тонкие договорённости. Часто появляется роль посредника или сопровождающего.",
    shadow:
      "Под давлением связь может удерживаться слишком жёстко: появляется контроль, страх разрыва, гиперответственность за чужое состояние. Контакт теряет свободу.",
    deficit:
      "Может не хватать собственного шага: оставаясь «между», легко забыть о собственных потребностях и выборе. Связь не обязательно рушится, когда внимание возвращается к себе."
  },
  breaker: {
    dominant:
      "Ведущая стратегия — несоответствие пустой форме. Легко видны устаревшие правила и иллюзии, появляется способность действовать иначе и освобождать пространство от лишнего. Это приносит обновление.",
    shadow:
      "В сильном напряжении разрушение становится хаотичным: ломается не только лишнее, но и ценное. Свобода теряет направление, появляется резкость.",
    deficit:
      "Может не хватать устойчивости после изменений: разрушить проще, чем собрать. Рост требует не только слома, но и проживания, закрепления нового."
  },
  integrator: {
    dominant:
      "Основная способность — проживание и интеграция. После утрат и кризисов сохраняется внутренний контакт с собой, переживания постепенно соединяются в опыт. Это глубокая восстановительная работа.",
    shadow:
      "Если боли слишком много и слишком долго, жизнь сужается до выживания. Появляется застревание в терпении и восстановлении, движение откладывается.",
    deficit:
      "Может не хватать импульса к следующему шагу: после сборки важно возвращаться к жизни, а не оставаться только в восстановлении."
  },
  wanderer: {
    dominant:
      "Ведущая стратегия — движение и изменение. Есть готовность идти в неизвестное, обучаться по ходу пути и менять траекторию. Это даёт гибкость и адаптивность.",
    shadow:
      "При перегрузке движение превращается в избегание: появляется склонность уходить, не задерживаясь достаточно долго. Путь теряет направление.",
    deficit:
      "Может не хватать остановки и укоренения. Не каждый этап требует перехода; иногда развитие происходит через присутствие и удерживание."
  }
};

const QUESTIONS = [
  // --- DOMINANT ---
  { id: 1, block: "dominant", text: "Ты выходишь к тёмному лесу. Дальше — неизвестно. У самой границы стоит изба на курьих ножках.",
    answers: [
      { t: "Остановиться и прислушаться: пускают ли дальше.", a: "gatekeeper" },
      { t: "Сделать шаг, даже если впереди непонятно.", a: "wanderer" },
      { t: "Поступить не по правилам и войти неожиданно.", a: "breaker" },
      { t: "Искать проводника и держаться связи.", a: "connector" }
    ]
  },
  { id: 2, block: "dominant", text: "Ночью в саду вспыхивает странный свет, как будто что-то зовёт.",
    answers: [
      { t: "Пойти за светом: если зов есть — значит, пора.", a: "spark" },
      { t: "Попытаться понять, что это значит и к чему ведёт.", a: "namer" },
      { t: "Сохранить устойчивость: не трогать неизвестное.", a: "support" },
      { t: "Подождать: вдруг это не знак, а случайность.", a: "gatekeeper" }
    ]
  },
  { id: 3, block: "dominant", text: "Путь оказывается долгим и тяжёлым. Быстрых решений нет.",
    answers: [
      { t: "Продолжать шаг за шагом, сколько бы ни заняло.", a: "support" },
      { t: "Разобраться в смысле происходящего, чтобы действовать точнее.", a: "namer" },
      { t: "Сломать привычный способ и сделать по-своему.", a: "breaker" },
      { t: "Держать контакт с теми, кто рядом, чтобы не распалось.", a: "connector" }
    ]
  },
  { id: 4, block: "dominant", text: "Становится ясно: прежний порядок больше не работает.",
    answers: [
      { t: "Принять это как часть пути и идти дальше.", a: "wanderer" },
      { t: "Демонтаж старых правил: больше так нельзя.", a: "breaker" },
      { t: "Сохранить хотя бы базовую устойчивость и ритм.", a: "support" },
      { t: "Собрать себя после изменения и продолжать уже иначе.", a: "integrator" }
    ]
  },
  { id: 5, block: "dominant", text: "Ты оказываешься между двумя сторонами, которые не слышат друг друга.",
    answers: [
      { t: "Остаться мостом и удерживать контакт.", a: "connector" },
      { t: "Выбрать путь и идти дальше, не втягиваясь.", a: "wanderer" },
      { t: "Разорвать узел: пусть каждый сам.", a: "breaker" },
      { t: "Остановить ситуацию рамкой: дальше так нельзя.", a: "gatekeeper" }
    ]
  },
  { id: 6, block: "dominant", text: "Происходит утрата: что-то важное разрушено, и привычного больше нет.",
    answers: [
      { t: "Дать себе время прожить и собрать себя заново.", a: "integrator" },
      { t: "Искать новый импульс, чтобы двигаться дальше.", a: "spark" },
      { t: "Держаться за остатки стабильности и продолжать.", a: "support" },
      { t: "Понять, что это значит и чему учит.", a: "namer" }
    ]
  },
  { id: 7, block: "dominant", text: "Все говорят: «Так принято. Делай как все».",
    answers: [
      { t: "Сделать иначе, даже если это выглядит странно.", a: "breaker" },
      { t: "Сначала проверить: есть ли право и готовность идти против.", a: "gatekeeper" },
      { t: "Действовать внутри правил: так надёжнее.", a: "support" },
      { t: "Идти своим путём без спора и доказательств.", a: "wanderer" }
    ]
  },
  { id: 8, block: "dominant", text: "Распутье без указателей. Непонятно, какая дорога «правильная».",
    answers: [
      { t: "Идти, принимая, что путь меняет по ходу.", a: "wanderer" },
      { t: "Ждать внутреннего отклика и импульса начала.", a: "spark" },
      { t: "Прояснить смысл выбора, прежде чем идти.", a: "namer" },
      { t: "Проверить готовность к следующему шагу.", a: "gatekeeper" }
    ]
  },

  // --- SHADOW ---
  { id: 9, block: "shadow", text: "Лес смыкается, тропа теряется. Страшно и непонятно, что дальше.",
    answers: [
      { t: "Никого не подпускать: так безопаснее.", a: "gatekeeper" },
      { t: "Идти наугад, лишь бы не стоять.", a: "wanderer" },
      { t: "Резко сломать всё, чтобы вырваться из ощущения ловушки.", a: "breaker" },
      { t: "Схватиться за того, кто рядом, и не отпускать связь.", a: "connector" }
    ]
  },
  { id: 10, block: "shadow", text: "От тебя ждут решения, а сил почти нет.",
    answers: [
      { t: "Тянуть дальше через изнеможение: иначе всё рухнет.", a: "support" },
      { t: "Ждать знака/импульса: без него не сдвинуться.", a: "spark" },
      { t: "Уйти в размышления, откладывая шаг.", a: "namer" },
      { t: "Оборвать процесс: лучше прекратить, чем мучиться.", a: "breaker" }
    ]
  },
  { id: 11, block: "shadow", text: "Кто-то нарушает договор и причиняет боль.",
    answers: [
      { t: "Разорвать связь сразу и навсегда.", a: "breaker" },
      { t: "Удерживать связь любой ценой.", a: "connector" },
      { t: "Закрыться и больше никого не подпускать.", a: "gatekeeper" },
      { t: "Молчаливо переживать и тянуть внутри.", a: "integrator" }
    ]
  },
  { id: 12, block: "shadow", text: "Долгая ответственность без поддержки. Никто не сменяет.",
    answers: [
      { t: "Продолжать тащить: иначе всё рухнет.", a: "support" },
      { t: "Надеяться на внезапный «спасительный» толчок или знак.", a: "spark" },
      { t: "Уйти, бросив всё как есть.", a: "wanderer" },
      { t: "Пытаться найти оправдание и объяснение происходящему.", a: "namer" }
    ]
  },
  { id: 13, block: "shadow", text: "Мир требует быть «правильным», и это давит.",
    answers: [
      { t: "Действовать наперекор всем, только чтобы не подчиняться.", a: "breaker" },
      { t: "Сжаться и перестать проявляться.", a: "gatekeeper" },
      { t: "Объяснить и рационализировать, почему всё так.", a: "namer" },
      { t: "Исчезнуть в дороге/делах, чтобы не сталкиваться.", a: "wanderer" }
    ]
  },
  { id: 14, block: "shadow", text: "Утрата ещё жива, но времени на остановку нет.",
    answers: [
      { t: "Не чувствовать и просто продолжать.", a: "integrator" },
      { t: "Схватиться за новое, чтобы не оставаться в боли.", a: "spark" },
      { t: "Держаться за остатки прежнего, не отпуская.", a: "support" },
      { t: "Ломать всё вокруг, лишь бы не чувствовать.", a: "breaker" }
    ]
  },
  { id: 15, block: "shadow", text: "Ты между двумя сторонами, и обе тянут на себя.",
    answers: [
      { t: "Начать управлять ими, чтобы удержать ситуацию.", a: "connector" },
      { t: "Резко выбрать одну сторону и отрезать другую.", a: "breaker" },
      { t: "Уйти и оставить их разбираться самим.", a: "wanderer" },
      { t: "Запретить конфликт вообще, задав жёсткую рамку.", a: "gatekeeper" }
    ]
  },
  { id: 16, block: "shadow", text: "Долго нет ощущения смысла, и это начинает давить.",
    answers: [
      { t: "Искать объяснение каждому шагу.", a: "namer" },
      { t: "Ждать сильного зова, который «всё изменит».", a: "spark" },
      { t: "Механически продолжать: делать своё без вопросов.", a: "support" },
      { t: "Резко всё разрушить, потому что «так больше нельзя».", a: "breaker" }
    ]
  },

  // --- DEFICIT ---
  { id: 17, block: "deficit", text: "Новый этап требует отпустить старое. Это непросто.",
    answers: [
      { t: "Сначала прояснить, что именно отпускается и зачем.", a: "namer" },
      { t: "Сделать шаг в новое, даже без гарантий.", a: "wanderer" },
      { t: "Опереться на устойчивость и держать то, что работает.", a: "support" },
      { t: "Поставить границу: вход только при готовности.", a: "gatekeeper" }
    ]
  },
  { id: 18, block: "deficit", text: "Появляется ощущение «хочется нового», но непонятно, с чего начать.",
    answers: [
      { t: "Следовать импульсу: начать с малого, но начать.", a: "spark" },
      { t: "Дать этому форму словами: понять, что именно хочется.", a: "namer" },
      { t: "Сохранить стабильность и не раскачивать лодку.", a: "support" },
      { t: "Срезать лишние правила и сделать иначе, чем принято.", a: "breaker" }
    ]
  },
  { id: 19, block: "deficit", text: "Снова поднимается старая боль. Важно не повторить прежний сценарий.",
    answers: [
      { t: "Дать себе прожить и собрать опыт в целое.", a: "integrator" },
      { t: "Сделать шаг вперёд: путь лечит движением.", a: "wanderer" },
      { t: "Выстроить границы, чтобы больше не ранило.", a: "gatekeeper" },
      { t: "Найти контакт/поддержку и не оставаться одному.", a: "connector" }
    ]
  },
  { id: 20, block: "deficit", text: "Чьи-то действия мягко нарушают границы, но прямого конфликта нет.",
    answers: [
      { t: "Обозначить границу и остановить это.", a: "gatekeeper" },
      { t: "Сохранить контакт и договориться.", a: "connector" },
      { t: "Разорвать форму взаимодействия и сделать по-другому.", a: "breaker" },
      { t: "Продолжать спокойно, не делая резких шагов.", a: "support" }
    ]
  },
  { id: 21, block: "deficit", text: "Становится ясно: старые правила не работают. Нужна перестройка.",
    answers: [
      { t: "Демонтировать лишнее и освободить место для нового.", a: "breaker" },
      { t: "Удержать базовую устойчивость, пока всё меняется.", a: "support" },
      { t: "Понять, какие смыслы теперь актуальны.", a: "namer" },
      { t: "Начать путь заново, принимая переход.", a: "wanderer" }
    ]
  },
  { id: 22, block: "deficit", text: "Долго приходится идти одному, и становится тяжело.",
    answers: [
      { t: "Разрешить поддержке появиться: удерживать контакт.", a: "connector" },
      { t: "Продолжать держать курс и ритм.", a: "support" },
      { t: "Двигаться дальше, меняя среду и маршрут.", a: "wanderer" },
      { t: "Остановиться и проверить, что безопасно и уместно.", a: "gatekeeper" }
    ]
  },
  { id: 23, block: "deficit", text: "Происходит что-то странное и непонятное. Внутри много сигналов.",
    answers: [
      { t: "Назвать происходящее и собрать картину смысла.", a: "namer" },
      { t: "Дать себе время прожить и переварить.", a: "integrator" },
      { t: "Следовать импульсу: начать действие, чтобы прояснилось.", a: "spark" },
      { t: "Сократить лишнее и сохранить безопасность.", a: "gatekeeper" }
    ]
  },
  { id: 24, block: "deficit", text: "Всё стало слишком «на автомате». Нужно вернуть живость.",
    answers: [
      { t: "Искать искру и запускать движение.", a: "spark" },
      { t: "Собрать себя: восстановить контакт с переживаниями.", a: "integrator" },
      { t: "Сменить маршрут: выйти в путь и обновить опыт.", a: "wanderer" },
      { t: "Пересобрать форму: убрать лишнее и сделать иначе.", a: "breaker" }
    ]
  }
];

/* ===================== App State ===================== */
const app = document.getElementById("app");

const state = {
  order: [],
  idx: 0,
  picks: [], // {qId, block, archetype}
  scores: {
    dominant: initScore(),
    shadow: initScore(),
    deficit: initScore()
  },
  view: "start", // start | test | result
  resultStep: 0, // 0 dom, 1 shadow, 2 deficit
  result: null
};

function initScore(){
  return {
    gatekeeper: 0, spark: 0, namer: 0, support: 0,
    connector: 0, breaker: 0, integrator: 0, wanderer: 0
  };
}
function shuffle(arr){
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function resetTest(){
  state.idx = 0;
  state.picks = [];
  state.scores = { dominant: initScore(), shadow: initScore(), deficit: initScore() };
  state.order = shuffle([...Array(QUESTIONS.length).keys()]);
  state.view = "test";
  state.resultStep = 0;
  state.result = null;
  render();
}
function goHome(){
  state.view = "start";
  state.order = [];
  state.idx = 0;
  state.picks = [];
  state.scores = { dominant: initScore(), shadow: initScore(), deficit: initScore() };
  state.resultStep = 0;
  state.result = null;
  render();
}
function addScore(block, archetype){ state.scores[block][archetype] += 1; }
function removeScore(block, archetype){ state.scores[block][archetype] -= 1; }

function pickAnswer(answerObj){
  const qIndex = state.order[state.idx];
  const q = QUESTIONS[qIndex];
  state.picks[state.idx] = { qId: q.id, block: q.block, archetype: answerObj.a };
  addScore(q.block, answerObj.a);
  state.idx += 1;
  if (state.idx >= QUESTIONS.length){
    state.result = computeResult();
    state.view = "result";
    state.resultStep = 0;
  }
  render();
}
function goBack(){
  if (state.idx <= 0) return;
  const prev = state.picks[state.idx - 1];
  if (prev) removeScore(prev.block, prev.archetype);
  state.picks.pop();
  state.idx -= 1;
  render();
}

function computeResult(){
  function tieBreakMax(obj){
    const max = Math.max(...Object.values(obj));
    const ks = Object.entries(obj).filter(([,v]) => v === max).map(([k]) => k);
    return ks[Math.floor(Math.random()*ks.length)];
  }
  function tieBreakMin(obj){
    const min = Math.min(...Object.values(obj));
    const ks = Object.entries(obj).filter(([,v]) => v === min).map(([k]) => k);
    return ks[Math.floor(Math.random()*ks.length)];
  }
  return {
    dominant: tieBreakMax(state.scores.dominant),
    shadow: tieBreakMax(state.scores.shadow),
    deficit: tieBreakMin(state.scores.deficit)
  };
}
function pct(){
  return Math.round((state.idx / QUESTIONS.length) * 100);
}

/* ===================== UI Templates ===================== */
function renderStart(){
  app.innerHTML = `
    <div class="main">
      <div>
        <div class="kicker">ТЕСТ НА 24 ВОПРОСА</div>
        <div class="bigTitle">КАРТА АРХЕТИПОВ</div>
        <div class="divider"></div>
        <p class="bodyText">
          24 ситуации. Выбор лучше делать интуитивно — первый отклик обычно точнее.
          Вопросы и варианты ответов каждый раз перемешиваются.
        </p>
        <div class="controls">
          <button class="btn" id="startBtn">НАЧАТЬ</button>
          <button class="btn btnAuthor" id="authorBtn">
            <span>АВТОР ПРОЕКТА</span>
            <span class="btnSub">@Ket1yPerry</span>
          </button>
          <button class="linkBtn" id="howBtn">КАК СЧИТАЕТСЯ</button>
        </div>
      </div>

      <div class="side">
        <div class="sideBlock">
          <div class="sideLabel">Что получится</div>
          <p class="sideText">
            Результат показывает три позиции:
            <br>— доминирующую стратегию
            <br>— то, как она искажается под давлением (тень)
            <br>— и силу, которая сейчас недоиспользуется (дефицит).
          </p>
        </div>
        <div class="sideBlock">
          <div class="sideLabel">Важное</div>
          <p class="sideText">
            Здесь нет «правильных» ответов.
            Это не диагноз, а способ увидеть привычные реакции.
          </p>
          <div class="miniRow">
            <span class="pill">Вопросов: ${QUESTIONS.length}</span>
            <span class="pill">Архетипов: 8</span>
            <span class="pill">Блоков: 3</span>
          </div>
        </div>
      </div>
    </div>
  `;

  document.getElementById("startBtn").onclick = resetTest;
  document.getElementById("authorBtn").onclick = () => {
    window.open("https://t.me/Ket1yPerry", "_blank", "noopener,noreferrer");
  };
  document.getElementById("howBtn").onclick = () => alert(
`Подсчёт ведётся отдельно по трём блокам.
— Доминирующий: максимум в блоке «dominant»
— Тень: максимум в блоке «shadow»
— Дефицит: минимум в блоке «deficit»
Вопросы перемешиваются, но метки блоков остаются в данных.`
  );
}

function renderQuestion(){
  const qIndex = state.order[state.idx];
  const q = QUESTIONS[qIndex];

  const answers = shuffle(q.answers);
  const p = pct();

  // Скрываем блоки пользователю для «слепоты», но оставим тонкую подсказку прогресса.
  const kicker =
    (state.idx < 8)  ? "ПЕРВАЯ ЧАСТЬ"
  : (state.idx < 16) ? "ВТОРАЯ ЧАСТЬ"
  :                   "ТРЕТЬЯ ЧАСТЬ";

  app.innerHTML = `
    <div class="main">
      <div>
        <div class="kicker">${kicker} · ${state.idx + 1}/${QUESTIONS.length}</div>
        <div class="bigTitle questionTitle">
          ${q.text}
        </div>

        <div class="progressLine"><i style="width:${p}%;"></i></div>

        <div class="answers" id="answers"></div>

        <div class="controls">
          <button class="linkBtn" id="backBtn" ${state.idx === 0 ? "disabled" : ""}>НАЗАД</button>
          <button class="linkBtn" id="restartBtn">ЗАНОВО</button>
        </div>
      </div>

      <div class="side">
        <div class="sideBlock">
          <div class="sideLabel">Как отвечать</div>
          <p class="sideText">
            Выбирать лучше быстро. Если хочется «посчитать», стоит выбрать первый отклик.
          </p>
        </div>
        <div class="sideBlock">
          <div class="sideLabel">Подсказка</div>
          <p class="sideText">
            Если два варианта кажутся равными — выбрать тот, который ближе по ощущению сейчас.
          </p>
          <div class="miniRow">
            <span class="pill">Прогресс: ${p}%</span>
          </div>
        </div>
      </div>
    </div>
  `;

  const answersEl = document.getElementById("answers");
  answers.forEach((a) => {
    const el = document.createElement("div");
    el.className = "choice";
    el.tabIndex = 0;
    el.innerHTML = `<span class="bullet"></span><span class="choiceText">${a.t}</span>`;
    el.onclick = () => pickAnswer(a);
    el.onkeydown = (e) => { if (e.key === "Enter" || e.key === " ") pickAnswer(a); };
    answersEl.appendChild(el);
  });

  const backBtn = document.getElementById("backBtn");
  if (backBtn) backBtn.onclick = goBack;
  document.getElementById("restartBtn").onclick = resetTest;
}

function renderResult(){
  const r = state.result;

  const steps = [
    { key: "dominant", title: "ВЫ РЕАЛИЗУЕТЕСЬ ЧЕРЕЗ АРХЕТИП", btn: "ДАЛЬШЕ" },
    { key: "shadow",   title: "ПОД ДАВЛЕНИЕМ ВКЛЮЧАЕТСЯ",     btn: "ДАЛЬШЕ" },
    { key: "deficit",  title: "СЕЙЧАС НЕДОИСПОЛЬЗУЕТСЯ",      btn: "ЗАВЕРШИТЬ" }
  ];

  const step = steps[state.resultStep];
  const archKey = r[step.key];
  const archetype = ARCHETYPES[archKey];
  const subtitle = archetype.short;

  const text =
    (step.key === "dominant") ? RESULT_TEXTS[archKey].dominant :
    (step.key === "shadow")   ? RESULT_TEXTS[archKey].shadow :
                                RESULT_TEXTS[archKey].deficit;

  app.innerHTML = `
    <div class="main">
      <div>
        <div class="kicker">${step.title}</div>
        <div class="bigTitle resultTitle">${archetype.role}</div>
        ${archetype.character ? `<div class="resultSub">${archetype.character}</div>` : ""}
        <div class="divider"></div>
        <p class="bodyText resultText">${text}</p>

        <div class="controls">
          <button class="btn" id="nextBtn">${step.btn}</button>
          <button class="linkBtn" id="againBtn">ЗАНОВО</button>
        </div>
      </div>

      <div class="side">
        <div class="sideBlock">
          <div class="sideLabel">Ключ</div>
          <p class="sideText">${subtitle}</p>
        </div>

        <div class="sideBlock">
          <div class="sideLabel">Разделы</div>
          <div class="resultSteps">
            <div class="resultStep ${step.key === "dominant" ? "is-active" : ""}">Доминирующий</div>
            <div class="resultStep ${step.key === "shadow" ? "is-active" : ""}">Тень</div>
            <div class="resultStep ${step.key === "deficit" ? "is-active" : ""}">Дефицит</div>
          </div>
        </div>

        <div class="sideBlock">
          <div class="sideLabel">Навигация</div>
          <p class="sideText">
            Результат показывается в три шага: доминирующий → тень → дефицит.
          </p>
          <div class="miniRow">
            <span class="pill">Шаг: ${state.resultStep + 1}/3</span>
          </div>
        </div>

        <div class="sideBlock">
          <div class="sideLabel">Дальше</div>
          <p class="sideText">
            Это карта стратегий, а не приговор.
            Формулировки можно уточнять — тест будет развиваться.
          </p>
        </div>
      </div>
    </div>
  `;

  document.getElementById("againBtn").onclick = resetTest;
  document.getElementById("nextBtn").onclick = () => {
    if (state.resultStep < 2){
      state.resultStep += 1;
      render();
    } else {
      goHome();
    }
  };
}

/* ===================== Links ===================== */
document.getElementById("aboutLink").onclick = (e) => {
  e.preventDefault();
  alert("Раздел «Об архетипах» можно сделать отдельной страницей позже. Сейчас — заглушка.");
};
document.getElementById("settingsLink").onclick = (e) => {
  e.preventDefault();
  alert("Настройки (например, показать/скрыть подсказки) можно добавить позже. Сейчас — заглушка.");
};
document.getElementById("exitLink").onclick = (e) => {
  e.preventDefault();
  goHome();
};

/* ===================== Render Router ===================== */
function render(){
  if (state.view === "start") renderStart();
  else if (state.view === "test") renderQuestion();
  else renderResult();
}
render();
</script>
</body>
</html>
